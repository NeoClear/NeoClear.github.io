<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="NeoClear"><meta name="copyright" content="NeoClear"><title>Star Path</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">NeoClear</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">46</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">62</span></a></div></div></div><nav class="no-bg" id="nav"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Star Path</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="site-info"><div id="site-title">Star Path</div><div id="site-sub-title"></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2019/11/23/opengl/opengl-triangle/">opengl triangle</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-11-23</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/opengl/">opengl</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/visual-studio/">visual studio</a></span><div class="content"><p>开头先放下傅老师的视频教程地址：<a href="https://www.bilibili.com/video/av24353839" target="_blank" rel="noopener">是台湾腔，wsl</a></p>
<p>visual studio绝对是宇宙第一IDE！<br>在linux上调了半年的CMake，用visual studio两分钟搞定。<br>微软大法好。</p>
<p>今天的opengl学习内容是在window上画一个三角形。<br>直接贴代码吧，分着写多累呐。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> GLEW_STATIC</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用于绘制顶点的数组</span></span><br><span class="line"><span class="keyword">float</span> vertices[] = &#123;</span><br><span class="line">    <span class="number">-0.5f</span>, <span class="number">-0.5f</span>, <span class="number">0.0f</span>,</span><br><span class="line">    <span class="number">0.5f</span>, <span class="number">-0.5f</span>, <span class="number">0.0f</span>,</span><br><span class="line">    <span class="number">0.0f</span>, <span class="number">0.5f</span>, <span class="number">0.0f</span>,</span><br><span class="line">    <span class="number">0.8f</span>, <span class="number">0.8f</span>, <span class="number">0.0f</span>,</span><br><span class="line">    <span class="comment">// 0.5f, -0.5f, 0.0f,</span></span><br><span class="line">    <span class="comment">// 0.0f, 0.5f, 0.0f</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// index索引</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> indices[] = &#123;</span><br><span class="line">    <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>,</span><br><span class="line">    <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 顶点shader program</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *vertexShaderSource =</span><br><span class="line">    <span class="string">"#version 330 core\n"</span></span><br><span class="line">    <span class="comment">// 此行指将VAO中第6号index中指向的data储存在aPos中</span></span><br><span class="line">    <span class="comment">// location可以是0至15中任何一个值</span></span><br><span class="line">    <span class="comment">// 当然需要和下文中的attribute pointer的值相同</span></span><br><span class="line">    <span class="string">"layout(location = 6) in vec3 aPos;\n"</span></span><br><span class="line">    <span class="string">"void main() &#123; gl_Position = vec4(aPos.x, aPos.y, aPos.z, 1.0f); &#125;\n"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// fragment shader program</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *fragmentShaderSource = </span><br><span class="line">    <span class="string">"#version 330 core                        \n"</span></span><br><span class="line">    <span class="string">"out vec4 color;                          \n"</span></span><br><span class="line">    <span class="string">"void main() &#123;                            \n"</span></span><br><span class="line">    <span class="string">"    color = vec4(1.0f, 0.5f, 0.2f, 1.0f);\n"</span></span><br><span class="line">    <span class="string">"&#125;"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理窗口的键盘事件</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">processInput</span><span class="params">(GLFWwindow* window)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (glfwGetKey(window, GLFW_KEY_ESCAPE) == GLFW_PRESS)</span><br><span class="line">        glfwSetWindowShouldClose(window, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// glfw的简单设置</span></span><br><span class="line">    glfwInit();</span><br><span class="line">    glfwInitHint(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">3</span>);</span><br><span class="line">    glfwInitHint(GLFW_CONTEXT_VERSION_MINOR, <span class="number">3</span>);</span><br><span class="line">    <span class="comment">// 设置profile为core profile</span></span><br><span class="line">    <span class="comment">// 大概和opengl版本有关</span></span><br><span class="line">    <span class="comment">// 早期的pipeline为固定管线，现代的pipeline为可编程管线</span></span><br><span class="line">    <span class="comment">// 所以需要确定profile版本</span></span><br><span class="line">    glfwInitHint(GLFW_OPENGL_PROFILE, GLFW_OPENGL_CORE_PROFILE);</span><br><span class="line"></span><br><span class="line">    GLFWwindow* window = glfwCreateWindow(<span class="number">800</span>, <span class="number">600</span>, <span class="string">"Test"</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    </span><br><span class="line">    glfwMakeContextCurrent(window);</span><br><span class="line">    glViewport(<span class="number">0</span>, <span class="number">0</span>, <span class="number">800</span>, <span class="number">600</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注意在init glew之前必须先glfwMakeContextCurrent</span></span><br><span class="line">    <span class="comment">// 否则会init失败</span></span><br><span class="line">    glewExperimental = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (glewInit() != GLEW_OK) &#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">"Failed to init glew\n"</span>; glfwTerminate(); <span class="keyword">return</span> <span class="number">-1</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 新建VAO并绑定至当前vertex array</span></span><br><span class="line">    <span class="comment">// VAO相当于VBO的一个指针</span></span><br><span class="line">    <span class="comment">// 一个VBO可能包含多个信息，使用VAO可以更加方便</span></span><br><span class="line">    <span class="comment">// 这一部分非常复杂，建议之间观看傅老师的视频</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> VAO;</span><br><span class="line">    glGenVertexArrays(<span class="number">1</span>, &amp;VAO);</span><br><span class="line">    glBindVertexArray(VAO);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 新建VBO并绑定至当前buffer</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> VBO;</span><br><span class="line">    glGenBuffers(<span class="number">1</span>, &amp;VBO);</span><br><span class="line">    glBindBuffer(GL_ARRAY_BUFFER, VBO);</span><br><span class="line">    <span class="comment">// 将顶点信息读入当前buffer</span></span><br><span class="line">    glBufferData(GL_ARRAY_BUFFER, <span class="keyword">sizeof</span>(vertices), vertices, GL_STATIC_DRAW);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 新建EBO并绑定至当前上下文</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> EBO;</span><br><span class="line">    glGenBuffers(<span class="number">1</span>, &amp;EBO);</span><br><span class="line">    glBindBuffer(GL_ELEMENT_ARRAY_BUFFER, EBO);</span><br><span class="line">    glBufferData(GL_ELEMENT_ARRAY_BUFFER, <span class="keyword">sizeof</span>(indices), indices, GL_STATIC_DRAW);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 编译vertex shader</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> vertexShader = glCreateShader(GL_VERTEX_SHADER);</span><br><span class="line">    glShaderSource(vertexShader, <span class="number">1</span>, &amp;vertexShaderSource, <span class="literal">NULL</span>);</span><br><span class="line">    glCompileShader(vertexShader);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 编译fragment shader</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> fragmentShader = glCreateShader(GL_FRAGMENT_SHADER);</span><br><span class="line">    glShaderSource(fragmentShader, <span class="number">1</span>, &amp;fragmentShaderSource, <span class="literal">NULL</span>);</span><br><span class="line">    glCompileShader(fragmentShader);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建shader program</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> shaderProgram = glCreateProgram();</span><br><span class="line">    glAttachShader(shaderProgram, vertexShader);</span><br><span class="line">    glAttachShader(shaderProgram, fragmentShader);</span><br><span class="line">    glLinkProgram(shaderProgram);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置VAO的vertex attribute指针</span></span><br><span class="line">    <span class="comment">// 在这个例子里设置第6个pointer，将其指向当前当前buffer的具体位置</span></span><br><span class="line">    <span class="comment">// pointer的index可以是0至15中任意一个值</span></span><br><span class="line">    glVertexAttribPointer(<span class="number">6</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">3</span> * <span class="keyword">sizeof</span>(<span class="keyword">float</span>), (<span class="keyword">void</span> *)<span class="number">0</span>);</span><br><span class="line">    <span class="comment">// 激活当前VAO的第6个attribute pointer</span></span><br><span class="line">    glEnableVertexAttribArray(<span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!glfwWindowShouldClose(window)) &#123;</span><br><span class="line">        <span class="built_in">processInput</span>(window);</span><br><span class="line">        glClearColor(<span class="number">0.2f</span>, <span class="number">0.3f</span>, <span class="number">0.3f</span>, <span class="number">0.2f</span>);</span><br><span class="line">        glClear(GL_COLOR_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用这个VAO</span></span><br><span class="line">        glBindVertexArray(VAO);</span><br><span class="line">        <span class="comment">// 使用这个EBO</span></span><br><span class="line">        glBindBuffer(GL_ELEMENT_ARRAY_BUFFER, EBO);</span><br><span class="line">        <span class="comment">// 使用设置的shader program</span></span><br><span class="line">        glUseProgram(shaderProgram);</span><br><span class="line">        <span class="comment">// 使用当前的EBO画图</span></span><br><span class="line">        glDrawElements(GL_TRIANGLES, <span class="number">6</span>, GL_UNSIGNED_INT, <span class="number">0</span>);</span><br><span class="line">        <span class="comment">// 使用当前attribute pointer指向的数据画图</span></span><br><span class="line">        <span class="comment">// glDrawArrays(GL_TRIANGLES, 0, 6);</span></span><br><span class="line"></span><br><span class="line">        glfwSwapBuffers(window);</span><br><span class="line">        glfwPollEvents();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    glfwTerminate();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>有一说一，opengl的代码，不对着模板打，完全不知道怎么写<br>有一万个名字差不多的函数要调用，人能记得住🐎？？？</p>
<p>本节内容的重点是明白VBO和VAO的含义。<br>VBO相当与显卡上的一块缓冲区（准确来说是显存），其内容无法被显卡识别，是由CPU直接通过PCI-E复制到显卡上的。<br>VAO相当与指向一个VBO的指针，内部有15个小指针（0至15）。通过指定VAO和设置Attribute Pointer，显卡的opengl API能识别显存中的数据。（和CPU中的高速缓存地址计算寄存器差不多吧）</p>
<p>再接再厉吧，opengl真的不是人能学的。<br>没办法，谁让AMD是显卡公司呢</p>
<p>加一点内容：</p>
<p>opengl默认绘制三角形为逆时针绘制，假如三角形的点排序为顺时针，则会绘制图形的背面。<br>opengl默认绘制图形背面。假如不需要绘制图形背面，可以加入以下代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">glEnable(GL_CULL_FACE);</span><br><span class="line">glCullFace(GL_FRONT);</span><br></pre></td></tr></table></figure>

<p>假如想要将多边形绘制成线条状，可以使用以下函数：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">glPolygonMode(GL_FRONT_AND_BACK, GL_LINE);</span><br></pre></td></tr></table></figure>

<p>opengl可以理解为一个状态机，拥有一个context。<br>上文中的各种bind函数将VAO、VBO、EBO绑定至当前context，然后使用其组合绘制图形。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/11/19/linux/driver/linux-driver-1/">linux driver-1</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-11-19</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/linux/">linux</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/driver/">driver</a></span><div class="content"><p>说真的，想写linux driver，先把linux操作系统原理看一遍吧。。。<br>我真的是傻，想在一天之内就学会这个。。。<br>就当是一次教训吧。记录下</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">obj-m := hello.o</span><br><span class="line">KERNELBUILD :=/lib/modules/<span class="variable">$(<span class="built_in">shell</span> uname -r)</span>/build</span><br><span class="line"><span class="section">default:</span></span><br><span class="line">	make -C <span class="variable">$(KERNELBUILD)</span> M=<span class="variable">$(<span class="built_in">shell</span> pwd)</span> modules</span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">	rm -rf *.o *.ko *.mod.c .*.cmd *.markers *.order *.symvers .tmp_versions</span><br></pre></td></tr></table></figure>

<p>注意，Makefile必须首字母大写，否则编译失败。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/init.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/kernel.h&gt;</span></span></span><br><span class="line">MODULE_LICENSE(<span class="string">"Dual BSD/GPL"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> __<span class="function">init <span class="title">hello_init</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    printk(KERN_EMERG <span class="string">"Hello, world\n"</span>);</span><br><span class="line">    <span class="keyword">int</span> t = <span class="number">2333</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> __<span class="function"><span class="built_in">exit</span> <span class="title">hello_exit</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    printk(KERN_EMERG <span class="string">"Goodbye, cruel world\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module_init(hello_init);</span><br><span class="line">module_exit(hello_exit);</span><br></pre></td></tr></table></figure>

<p>至于驱动程序的代码，就是用module_init和module_exit在内核中注册驱动。<br>注意printk里的宏没有逗号，否则内核无法输出信息。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/11/19/tools/Google-Test-1/">Google Test-1</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-11-19</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/cmake/">cmake</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/gtest/">gtest</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Google-Test/">Google Test</a></span><div class="content"><p>Google Test</p>
<p>CMakeLists大概长这样：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required(VERSION <span class="number">2.8</span>)</span><br><span class="line"></span><br><span class="line">project(gtest)</span><br><span class="line"></span><br><span class="line">find_package(GTest REQUIRED)</span><br><span class="line">find_package(Threads REQUIRED)</span><br><span class="line"></span><br><span class="line">include_directories($&#123;GTEST_INCLUDE_DIRS&#125;)</span><br><span class="line"></span><br><span class="line">add_executable(MyTest test.cpp)</span><br><span class="line">target_link_libraries(MyTest $&#123;GTEST_BOTH_LIBRARIES&#125;)</span><br><span class="line">target_link_libraries(MyTest $&#123;CMAKE_THREAD_LIBS_INIT&#125;)</span><br><span class="line"></span><br><span class="line">add_test(Test MyTest)</span><br><span class="line">enable_testing()</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;gtest/gtest.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;numeric&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line">TEST(MyTest, Sum)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; vec&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> sum = <span class="built_in">std</span>::accumulate(vec.<span class="built_in">begin</span>(), vec.<span class="built_in">end</span>(), <span class="number">0</span>);</span><br><span class="line">    EXPECT_EQ(sum, <span class="number">15</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    testing::InitGoogleTest(&amp;argc, argv);</span><br><span class="line">    <span class="keyword">return</span> RUN_ALL_TESTS();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中TEST宏的第一个参数是Test Suit，而第二个参数是Test Case。<br>最后make test就可以单元测试了。<br>说真的，这些代码，根本记不住啊。。。要用的时候直接拷贝吧。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/11/18/tools/CMake-2/">CMake-2</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-11-18</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/cmake/">cmake</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/build/">build</a></span><div class="content"><p>This is the second part of CMake Tutorial.</p>
<p>In this part we mainly focus on how to write a script to install our software.</p>
<p>we just need write like this.</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CMakeLists.txt</span></span><br><span class="line"><span class="keyword">install</span>(TARGETS power DESTINATION bin)</span><br><span class="line"><span class="keyword">install</span>(FILES <span class="string">"$&#123;PROJECT_BINARY_DIR&#125;/config.h"</span></span><br><span class="line">        DESTINATION <span class="keyword">include</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># math/CMakeLists.txt</span></span><br><span class="line"><span class="keyword">install</span>(TARGETS math_functions DESTINATION bin)</span><br><span class="line"><span class="keyword">install</span>(FILES power.h DESTINATION <span class="keyword">include</span>)</span><br></pre></td></tr></table></figure>

<p>Very simple right?</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/11/18/tools/CMake-1/">CMake-1</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-11-18</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/cmake/">cmake</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/build/">build</a></span><div class="content"><p>It is wired to type purely English…<br>But it is difficult to type Chinese in linux, so…</p>
<p>Today we will take a look at CMake, a cross-platform build tool.<br>With the help of this tool, it is simpler to port your project into different operating systems like Windows and OS-X.</p>
<p>This document is written based on other blogs.</p>
<h2 id="Case-1-single-file"><a href="#Case-1-single-file" class="headerlink" title="Case 1: single file"></a>Case 1: single file</h2><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">2.8</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">project</span>(<span class="keyword">math</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_executable</span>(power main.cpp)</span><br></pre></td></tr></table></figure>

<p>In this case, CMake will generate a makefile(on linux) that generates a program called power given main.cpp. You do not have to consider the detail of compile process. Just one line.</p>
<p>Moreover, you can set up the version of the current project by doing the following:</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">project</span>(<span class="keyword">math</span> VERSION <span class="number">1.0</span>)</span><br></pre></td></tr></table></figure>

<h2 id="Case-2-multiple-files"><a href="#Case-2-multiple-files" class="headerlink" title="Case 2: multiple files"></a>Case 2: multiple files</h2><p>If we want to compile all files in the current directory to a program, we can use the following command to store the name of all files into a variable, and then use it in the process.</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">aux_source_directory</span>(. SRC)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_executable</span>(<span class="keyword">math</span> <span class="variable">$&#123;SRC&#125;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="Case-3-multiple-files-in-multiple-dirs"><a href="#Case-3-multiple-files-in-multiple-dirs" class="headerlink" title="Case 3: multiple files in multiple dirs"></a>Case 3: multiple files in multiple dirs</h2><p>CMake makes it easier to keep the project organized.<br>Here is an example of how CMakeLists.txt should be in a multi-dir project.</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CMakeLists.txt</span></span><br><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">2.8</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">project</span>(power)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Go to the subdir and manage files there</span></span><br><span class="line"><span class="keyword">add_subdirectory</span>(<span class="keyword">math</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_executable</span>(power main.cpp)</span><br><span class="line"></span><br><span class="line"><span class="comment"># link library to the executable file</span></span><br><span class="line"><span class="keyword">target_link_libraries</span>(power math_functions)</span><br></pre></td></tr></table></figure>

<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># math/CMakeLists.txt</span></span><br><span class="line"><span class="keyword">aux_source_directory</span>(. LIB_MATH)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_library</span>(math_functions <span class="variable">$&#123;LIB_MATH&#125;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="Case-4-customize-compiling-process"><a href="#Case-4-customize-compiling-process" class="headerlink" title="Case 4: customize compiling process"></a>Case 4: customize compiling process</h2><p>To be honest, CMake is as difficult as makefile. There are endless commands.</p>
<p>Sometimes we want to use different libraries based on different macros we define. Thus, we have:</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CMakeLists.txt</span></span><br><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">2.8</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">project</span>(power)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Determine configure file</span></span><br><span class="line"><span class="keyword">configure_file</span>(</span><br><span class="line">    <span class="string">"$&#123;PROJECT_SOURCE_DIR&#125;/config.h.in"</span></span><br><span class="line">    <span class="string">"$&#123;PROJECT_BINARY_DIR&#125;/config.h"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the macro value</span></span><br><span class="line"><span class="keyword">option</span>(USE_MATH</span><br><span class="line">       <span class="string">"Use provided math library"</span> <span class="keyword">ON</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># If true, then add library and add subdirectory</span></span><br><span class="line"><span class="keyword">if</span>(USE_MATH)</span><br><span class="line">    <span class="keyword">include_directories</span>(<span class="string">"$&#123;PROJECT_SOURCE_DIR&#125;/math"</span>)</span><br><span class="line">    <span class="keyword">add_subdirectory</span>(<span class="keyword">math</span>)</span><br><span class="line">    <span class="keyword">set</span>(LIBS <span class="variable">$&#123;LIBS&#125;</span> math_functions)</span><br><span class="line"><span class="keyword">endif</span>(USE_MATH)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_executable</span>(power main.cpp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">target_link_libraries</span>(power <span class="variable">$&#123;LIBS&#125;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># math/CMakeLists.txt</span></span><br><span class="line"><span class="keyword">aux_source_directory</span>(. LIB_MATH)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_library</span>(math_functions <span class="variable">$&#123;LIB_MATH&#125;</span>)</span><br></pre></td></tr></table></figure>

<p>Also we need to have a config.h.in file to generate config.h<br>There are several circumstances.<br>If:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#cmakedefine USE_MATH</span><br></pre></td></tr></table></figure>

<p>then the generated config.h will be</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> USE_MATH</span></span><br></pre></td></tr></table></figure>

<p>If:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#cmakedefine USE_MATH &quot;2333&quot;</span><br></pre></td></tr></table></figure>

<p>then the generated config.h will be</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> USE_MATH <span class="meta-string">"2333"</span></span></span><br></pre></td></tr></table></figure>

<p>If:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#cmakedefine USE_MATH &quot;@USE_MATH@&quot;</span><br></pre></td></tr></table></figure>

<p>then the generated config.h will be</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> USE_MATH <span class="meta-string">"ON"</span></span></span><br></pre></td></tr></table></figure>

<p>We end here today</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/11/17/data_structure/heap/">heap</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-11-17</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/heap/">heap</a></span><div class="content"><p>非常简单的数据结构。<br>唯一复杂的部分是down函数。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">heap</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;ll&gt; dat;</span><br><span class="line"></span><br><span class="line">    heap(): dat(<span class="number">1</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">ll <span class="title">up</span><span class="params">(ll k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (dat[k / <span class="number">2</span>] &gt; dat[k]) &#123; swap(dat[k / <span class="number">2</span>], dat[k]); <span class="keyword">return</span> <span class="number">1</span>; &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">has_left</span><span class="params">(ll k)</span> </span>&#123; <span class="keyword">return</span> k * <span class="number">2</span> &lt;= <span class="built_in">size</span>(); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">has_right</span><span class="params">(ll k)</span> </span>&#123; <span class="keyword">return</span> k * <span class="number">2</span> + <span class="number">1</span> &lt;= <span class="built_in">size</span>(); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">ll <span class="title">down</span><span class="params">(ll k)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// return 0 -&gt; no change</span></span><br><span class="line">        <span class="comment">// return -1 -&gt; swap left son</span></span><br><span class="line">        <span class="comment">// return 1 -&gt; swap right son</span></span><br><span class="line">        <span class="keyword">if</span> (has_right(k)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (dat[k] &lt;= <span class="built_in">min</span>(dat[k * <span class="number">2</span>], dat[k * <span class="number">2</span> + <span class="number">1</span>])) &#123; <span class="keyword">return</span> <span class="number">0</span>; &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (dat[k * <span class="number">2</span>] &lt; dat[k * <span class="number">2</span> + <span class="number">1</span>]) &#123; swap(dat[k], dat[k * <span class="number">2</span>]); <span class="keyword">return</span> <span class="number">-1</span>; &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123; swap(dat[k], dat[k * <span class="number">2</span> + <span class="number">1</span>]); <span class="keyword">return</span> <span class="number">1</span>; &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (has_left(k) &amp;&amp; dat[k * <span class="number">2</span>] &lt; dat[k]) &#123; swap(dat[k], dat[k * <span class="number">2</span>]); <span class="keyword">return</span> <span class="number">-1</span>; &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">push</span><span class="params">(ll val)</span> </span>&#123;</span><br><span class="line">        dat.push_back(val);</span><br><span class="line">        ll k = dat.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (k != <span class="number">1</span> &amp;&amp; up(k)) &#123; k /= <span class="number">2</span>; &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">ll <span class="title">front</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> dat[<span class="number">1</span>]; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        swap(dat[<span class="number">1</span>], dat[<span class="built_in">size</span>()]);</span><br><span class="line">        dat.pop_back();</span><br><span class="line">        ll op, k = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> ((op = down(k)) != <span class="number">0</span>) &#123; k = (op == <span class="number">-1</span> ? <span class="number">0</span> : <span class="number">1</span>) + k * <span class="number">2</span>; &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">ll <span class="title">size</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> dat.<span class="built_in">size</span>() - <span class="number">1</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    heap ins;</span><br><span class="line">    <span class="keyword">int</span> N;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; N;</span><br><span class="line">    <span class="keyword">while</span> (N--) &#123; <span class="keyword">int</span> n; <span class="built_in">cin</span> &gt;&gt; n; ins.push(n); &#125;</span><br><span class="line">    <span class="keyword">while</span> (ins.<span class="built_in">size</span>()) &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; ins.front();</span><br><span class="line">        ins.pop();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/11/16/hdu/hdu-2063/">hdu 2063</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-11-16</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/bipartite-graph/">bipartite graph</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/max-matching/">max matching</a></span><div class="content"><p>真的，为什么，我的正确率总是这么低？？？<br>一开始做BZOJ的一道题，debug三小时还没法解决，只能换了一道HDU的模板题。。。</p>
<p>幸好模板题还是挺简单的。<br>最重要的是extend部分。<br>使用函数调用栈非常巧妙地储存了中间值，却没有使用额外的变量。（妙啊）</p>
<p>另外，最大匹配也可以使用最大流算法解决。<br>将二分图的左侧全部连到同一个source，右侧连到同一个dest，最大流就是最大匹配。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SIZE 100010</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ll ans = <span class="number">0</span>; <span class="keyword">bool</span> f = <span class="literal">true</span>; <span class="keyword">char</span> ch = getchar();</span><br><span class="line">    <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) &#123; <span class="keyword">if</span> (ch == <span class="string">'-'</span>) f = <span class="literal">false</span>; ch = getchar(); &#125;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) &#123; ans = ans * <span class="number">10</span> + ch - <span class="string">'0'</span>; ch = getchar(); &#125;</span><br><span class="line">    <span class="keyword">return</span> f ? ans : -ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">    ll to, w, next;</span><br><span class="line">&#125; edges[SIZE];</span><br><span class="line"></span><br><span class="line">ll top = <span class="number">0</span>;</span><br><span class="line">ll K, M, N;</span><br><span class="line">ll vertex[SIZE];</span><br><span class="line"><span class="keyword">int</span> book[SIZE];</span><br><span class="line">ll match[SIZE];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123; <span class="built_in">memset</span>(edges, <span class="number">0</span>, <span class="keyword">sizeof</span>(edges)); <span class="built_in">memset</span>(vertex, <span class="number">0</span>, <span class="keyword">sizeof</span>(vertex)); <span class="built_in">memset</span>(match, <span class="number">0</span>, <span class="keyword">sizeof</span>(match)); top = <span class="number">0</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(ll from, ll to, ll w)</span> </span>&#123; edges[++top] = (Edge)&#123;to, w, vertex[from]&#125;; vertex[from] = top; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">extend</span><span class="params">(ll cur)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (ll it = vertex[cur]; it; it = edges[it].next) &#123;</span><br><span class="line">        ll dest = edges[it].to;</span><br><span class="line">        <span class="keyword">if</span> (!book[dest]) &#123;</span><br><span class="line">            book[dest] = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (match[dest] == <span class="number">0</span> || extend(match[dest])) &#123;</span><br><span class="line">                match[dest] = cur;</span><br><span class="line">                match[cur] = dest;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ll ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (ll i = <span class="number">1</span>; i &lt;= M + N; i++) &#123;</span><br><span class="line">        <span class="built_in">memset</span>(book, <span class="number">0</span>, <span class="keyword">sizeof</span>(book));</span><br><span class="line">        <span class="keyword">if</span> (!match[i]) &#123; ans += extend(i); &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, ans);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> ((K = <span class="built_in">read</span>()) &amp;&amp; (M = <span class="built_in">read</span>()) &amp;&amp; (N = <span class="built_in">read</span>())) &#123;</span><br><span class="line">        init();</span><br><span class="line">        <span class="keyword">for</span> (ll i = <span class="number">0</span>; i &lt; K; i++) &#123;</span><br><span class="line">            ll g = <span class="built_in">read</span>(), b = <span class="built_in">read</span>();</span><br><span class="line">            insert(g, b + M, <span class="number">0</span>); insert(b + M, g, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        solve();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/11/16/data_structure/adjacency-table/">adjacency table</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-11-16</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/adjacency-table/">adjacency table</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/graph/">graph</a></span><div class="content"><p>传统的邻接表。比用vector和map实现效率更高。<br>vertex[i]记录与点i相邻的点的第一个Edge边。通过遍历获得所有相邻的点。<br>需要注意的是边的index从1开始，因为0代表着遍历的结束。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SIZE 100010</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">    ll to, w, next;</span><br><span class="line">&#125; edges[SIZE];</span><br><span class="line"></span><br><span class="line">ll top = <span class="number">0</span>;</span><br><span class="line">ll vertex[SIZE];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(ll from, ll to, ll w)</span> </span>&#123; edges[++top] = (Edge)&#123;to, w, vertex[from]&#125;; vertex[from] = top; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123; <span class="built_in">memset</span>(vertex, <span class="number">0</span>, <span class="keyword">sizeof</span>(vertex)); &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    init();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/11/16/bzoj/bzoj-2200/">bzoj 2200</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-11-16</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/spfa/">spfa</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/bzoj/">bzoj</a></span><div class="content"><p>其实严格意义上来讲，这道题并没有AC。<br>据说标准的SPFA会被卡常数。<br>但是TLE意味着答案是正确的，所以就恬不知耻地放这了。</p>
<p>SPFA基本原理：</p>
<p>讲要松弛的点入栈。<br>使用每个出栈的点对相邻的点进行松弛，松弛成功就入栈。</p>
<p>特性：每个点最多松弛N次（N为点数）。假如超过N，则此图存在负环。<br>使用used数组记录此点是否在栈内。假如在栈内，则无需将此点入栈，只需松弛。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> inf 0x7fffffff</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SIZE 100010</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">    ll to, w, next;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ll ans = <span class="number">0</span>; <span class="keyword">bool</span> f = <span class="literal">true</span>; <span class="keyword">char</span> ch = getchar();</span><br><span class="line">    <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) &#123; <span class="keyword">if</span> (ch == <span class="string">'-'</span>) f = <span class="literal">false</span>; ch = getchar(); &#125;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) &#123; ans = ans * <span class="number">10</span> + ch - <span class="string">'0'</span>; ch = getchar(); &#125;</span><br><span class="line">    <span class="keyword">return</span> f ? ans : -ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ll T, R, P, S;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> <span class="title">edges</span>[<span class="title">SIZE</span>];</span> ll top = <span class="number">0</span>;</span><br><span class="line">ll vertex[SIZE];</span><br><span class="line">ll dis[SIZE];</span><br><span class="line"><span class="keyword">bool</span> used[SIZE];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(ll from, ll to, ll w)</span> </span>&#123;</span><br><span class="line">    edges[++top] = (Edge)&#123;to, w, vertex[from]&#125;;</span><br><span class="line">    vertex[from] = top;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123; <span class="built_in">memset</span>(vertex, <span class="number">0</span>, <span class="keyword">sizeof</span>(vertex)); <span class="built_in">memset</span>(used, <span class="number">0</span>, <span class="keyword">sizeof</span>(used)); <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; SIZE; i++) dis[i] = inf; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">spfa</span><span class="params">(ll src)</span> </span>&#123;</span><br><span class="line">    dis[src] = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">queue</span>&lt;ll&gt; q; q.push(src);</span><br><span class="line">    used[src] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">while</span> (!q.empty()) &#123;</span><br><span class="line">        ll cur = q.front(); q.pop();</span><br><span class="line">        ll it = vertex[cur];</span><br><span class="line">        used[cur] = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">while</span> (it) &#123;</span><br><span class="line">            ll dest = edges[it].to;</span><br><span class="line">            <span class="keyword">if</span> (dis[cur] + edges[it].w &lt; dis[dest]) &#123;</span><br><span class="line">                dis[dest] = dis[cur] + edges[it].w;</span><br><span class="line">                <span class="keyword">if</span> (!used[dest]) &#123; used[dest] = <span class="literal">true</span>; q.push(dest); &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            it = edges[it].next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    init();</span><br><span class="line">    T = <span class="built_in">read</span>(); R = <span class="built_in">read</span>(); P = <span class="built_in">read</span>(); S = <span class="built_in">read</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; R; i++) &#123;</span><br><span class="line">        ll from, to, w; from = <span class="built_in">read</span>(); to = <span class="built_in">read</span>(); w = <span class="built_in">read</span>();</span><br><span class="line">        insert(from, to, w); insert(to, from, w);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; P; i++) &#123;</span><br><span class="line">        ll from, to, w; from = <span class="built_in">read</span>(); to = <span class="built_in">read</span>(); w = <span class="built_in">read</span>();</span><br><span class="line">        insert(from, to, w);</span><br><span class="line">    &#125;</span><br><span class="line">    spfa(S);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= T; i++) &#123; <span class="keyword">if</span> (dis[i] == inf) <span class="built_in">printf</span>(<span class="string">"NO PATH\n"</span>); <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, dis[i]); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/11/16/poj/poj-1273-Drainage-Ditches/">poj 1273 Drainage Ditches</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-11-16</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/poj/">poj</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/edmonds-karp/">edmonds karp</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/ford-fulkerson/">ford fulkerson</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/max-flow/">max flow</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/network-flow/">network flow</a></span><div class="content"><p>我真的想杀人，真的。<br>因为题目描述没看仔细，硬生生多花了3小时debug。。。<br>真的醉了。。。<br>🐎🐎🐎</p>
<p>言归正传，edmonds karp算法就长下面这个样子。</p>
<p>使用邻接矩阵储存图，毕竟需要修改边。而邻接表不适合O(1)时间修改边的值。<br>每次bfs需要把flow数组清空。</p>
<p>看这代码风格，我又想到了当年集训的场景。<br>身边的大佬都喜欢把几行代码挤在一行花括号内。。。的确，打OI代码可读性低可以理解，反正只要自己看得懂就行。<br>最重要的是，OI不按代码行数打分🐎🕊🐓。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> inf 0x7fffffff</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SIZE 210</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> int64;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    int64 ans = <span class="number">0</span>; <span class="keyword">bool</span> f = <span class="literal">true</span>; <span class="keyword">char</span> ch = getchar();</span><br><span class="line">    <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) &#123; <span class="keyword">if</span> (ch == EOF) <span class="keyword">return</span> <span class="number">-1</span>; <span class="keyword">if</span> (ch == <span class="string">'-'</span>) f = <span class="literal">false</span>; ch = getchar(); &#125;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) &#123; ans = ans * <span class="number">10</span> + ch - <span class="string">'0'</span>; ch = getchar(); &#125;</span><br><span class="line">    <span class="keyword">return</span> f ? ans : -ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> N, M;</span><br><span class="line">ll graph[SIZE][SIZE];</span><br><span class="line">ll flow[SIZE];</span><br><span class="line"><span class="keyword">int</span> pre[SIZE];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123; <span class="built_in">memset</span>(graph, <span class="number">0</span>, <span class="keyword">sizeof</span>(graph)); &#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">bfs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(pre, <span class="number">-1</span>, <span class="keyword">sizeof</span>(pre)); pre[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">memset</span>(flow, <span class="number">0</span>, <span class="keyword">sizeof</span>(flow)); flow[<span class="number">1</span>] = inf;</span><br><span class="line">    <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line">    q.push(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">while</span> (!q.empty()) &#123;</span><br><span class="line">        <span class="keyword">int</span> cur = q.front(); q.pop();</span><br><span class="line">        <span class="keyword">if</span> (cur == M) &#123; <span class="keyword">break</span>; &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> dest = <span class="number">1</span>; dest &lt;= M; dest++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (graph[cur][dest] &gt; <span class="number">0</span> &amp;&amp; pre[dest] == <span class="number">-1</span>) &#123;</span><br><span class="line">                flow[dest] = <span class="built_in">min</span>(flow[cur], graph[cur][dest]);</span><br><span class="line">                q.push(dest);</span><br><span class="line">                pre[dest] = cur;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pre[M] == <span class="number">-1</span> ? <span class="number">-1</span> : flow[M];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">edmonds_karp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ll inc = <span class="number">0</span>, max_flow = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> ((inc = bfs()) != <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> it = M;</span><br><span class="line">        <span class="keyword">while</span> (it != <span class="number">1</span>) &#123;</span><br><span class="line">            graph[pre[it]][it] -= inc;</span><br><span class="line">            graph[it][pre[it]] += inc;</span><br><span class="line">            it = pre[it];</span><br><span class="line">        &#125;</span><br><span class="line">        max_flow += inc;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; max_flow &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> ((N = <span class="built_in">read</span>()) != <span class="number">-1</span> &amp;&amp; (M = <span class="built_in">read</span>()) != <span class="number">-1</span>) &#123;</span><br><span class="line">        init();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> from, to; ll cap;</span><br><span class="line">            from = <span class="built_in">read</span>(); to = <span class="built_in">read</span>(); cap = <span class="built_in">read</span>();</span><br><span class="line">            graph[from][to] += cap;</span><br><span class="line">        &#125;</span><br><span class="line">        edmonds_karp();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><hr></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/2/">&lt;i class=&quot;fa fa-chevron-left&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/4/">&lt;i class=&quot;fa fa-chevron-right&quot;&gt;&lt;&#x2F;i&gt;</a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2019 By NeoClear</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script>if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
}</script></body></html>